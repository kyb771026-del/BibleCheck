<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„±ê²½ ì§„ë„ ê´€ë¦¬ - ë‚ ì§œ ì—°ë™ ê°œì„ </title>
  <style>
    :root {
      --primary: #4a90e2; --secondary: #2ecc71; --danger: #e74c3c;
      --bg: #f8f9fa; --card: #ffffff;
    }
    body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: var(--card); border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
    
    .stats-row { display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap; margin-bottom: 15px; }
    .input-group { display: flex; flex-direction: column; gap: 5px; }
    input[type="date"] { padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
    .result-box { background: #f0f7ff; padding: 10px 15px; border-radius: 8px; border-left: 4px solid var(--primary); margin-top: 10px; }

    .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
    .btn-blue { background: var(--primary); color: white; }
    .btn-green { background: var(--secondary); color: white; }
    .btn-dark { background: #34495e; color: white; }
    .btn-red { background: var(--danger); color: white; }
    
    .progress-bar-bg { background: #eee; height: 12px; border-radius: 6px; overflow: hidden; margin: 15px 0; }
    .progress-fill { background: var(--primary); height: 100%; width: 0%; transition: width 0.4s; }

    .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 8px; }
    .book-item { padding: 10px 5px; background: #fff; border: 1px solid #dee2e6; border-radius: 6px; text-align: center; cursor: pointer; font-size: 0.85rem; }
    .book-item:hover { border-color: var(--primary); color: var(--primary); background: #f0f7ff; }

    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 450px; max-height: 80vh; overflow-y: auto; }
    .chaps-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-top: 15px; }
    .chap-btn { padding: 8px; border: 1px solid #eee; border-radius: 4px; background: white; cursor: pointer; }
    .chap-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="container">
  <div class="card">
    <h2 style="margin-top:0;">ğŸ“… ê¸°ê°„ë³„ ì½ì€ ì¥ ì¡°íšŒ</h2>
    <div class="stats-row">
      <div class="input-group">
        <label style="font-size:0.8rem;">ì‹œì‘ì¼</label>
        <input type="date" id="startDate">
      </div>
      <span>~</span>
      <div class="input-group">
        <label style="font-size:0.8rem;">ì¢…ë£Œì¼</label>
        <input type="date" id="endDate">
      </div>
      <button class="btn btn-blue" onclick="calcRangeStats()">í•©ê³„ ì¡°íšŒ</button>
    </div>
    <div class="result-box" id="rangeResult">
      ì¡°íšŒ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
    </div>
  </div>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
      <h1 style="margin:0;">ğŸ“– ì„±ê²½ ì½ê¸° ì§„ë„</h1>
      <div style="display:flex; gap:5px;">
        <button class="btn btn-green" onclick="saveData()">ì €ì¥</button>
        <button class="btn btn-dark" onclick="downloadHTML()">ë‹¤ìš´ë¡œë“œ</button>
      </div>
    </div>
    
    <div class="progress-bar-bg">
      <div id="progressFill" class="progress-fill"></div>
    </div>
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <span id="progressStat" style="font-weight:bold;">0 / 1,189 ì¥ (0%)</span>
      <button class="btn btn-red" style="padding:5px 10px; font-size:0.7rem;" onclick="resetAll()">ì´ˆê¸°í™”</button>
    </div>

    <div style="margin-top:20px; display:flex; gap:5px;">
      <button class="btn btn-blue" style="font-size:0.8rem;" onclick="filterList('all')">ì „ì²´</button>
      <button class="btn btn-blue" style="font-size:0.8rem;" onclick="filterList('old')">êµ¬ì•½</button>
      <button class="btn btn-blue" style="font-size:0.8rem;" onclick="filterList('new')">ì‹ ì•½</button>
    </div>

    <div id="oldSection">
      <h3>êµ¬ì•½</h3>
      <div id="oldGrid" class="books-grid"></div>
    </div>
    <div id="newSection" style="margin-top:20px;">
      <h3>ì‹ ì•½</h3>
      <div id="newGrid" class="books-grid"></div>
    </div>
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 id="modalTitle" style="margin:0;">ì„±ê²½ëª…</h3>
      <button onclick="closeModal()" style="border:none; background:none; font-size:1.5rem; cursor:pointer;">&times;</button>
    </div>
    <div id="chapGrid" class="chaps-grid"></div>
  </div>
</div>

<script>
  // ì„±ê²½ ë°ì´í„° ë°°ì—´ (ìƒëµ ì—†ì´ ì „ì²´ í¬í•¨)
  const bible = [
    {n:"ì°½ì„¸ê¸°", c:50, t:"old"}, {n:"ì¶œì• êµ½ê¸°", c:40, t:"old"}, {n:"ë ˆìœ„ê¸°", c:27, t:"old"}, {n:"ë¯¼ìˆ˜ê¸°", c:36, t:"old"}, {n:"ì‹ ëª…ê¸°", c:34, t:"old"},
    {n:"ì—¬í˜¸ìˆ˜ì•„", c:24, t:"old"}, {n:"ì‚¬ì‚¬ê¸°", c:21, t:"old"}, {n:"ë£¨ê¸°", c:4, t:"old"}, {n:"ì‚¬ë¬´ì—˜ìƒ", c:31, t:"old"}, {n:"ì‚¬ë¬´ì—˜í•˜", c:24, t:"old"},
    {n:"ì—´ì™•ê¸°ìƒ", c:22, t:"old"}, {n:"ì—´ì™•ê¸°í•˜", c:25, t:"old"}, {n:"ì—­ëŒ€ìƒ", c:29, t:"old"}, {n:"ì—­ëŒ€í•˜", c:36, t:"old"}, {n:"ì—ìŠ¤ë¼", c:10, t:"old"},
    {n:"ëŠí—¤ë¯¸ì•¼", c:13, t:"old"}, {n:"ì—ìŠ¤ë”", c:10, t:"old"}, {n:"ìš¥ê¸°", c:42, t:"old"}, {n:"ì‹œí¸", c:150, t:"old"}, {n:"ì ì–¸", c:31, t:"old"},
    {n:"ì „ë„ì„œ", c:12, t:"old"}, {n:"ì•„ê°€", c:8, t:"old"}, {n:"ì´ì‚¬ì•¼", c:66, t:"old"}, {n:"ì˜ˆë ˆë¯¸ì•¼", c:52, t:"old"}, {n:"ì• ê°€", c:5, t:"old"},
    {n:"ì—ìŠ¤ê²”", c:48, t:"old"}, {n:"ë‹¤ë‹ˆì—˜", c:12, t:"old"}, {n:"í˜¸ì„¸ì•„", c:14, t:"old"}, {n:"ìš”ì—˜", c:3, t:"old"}, {n:"ì•„ëª¨ìŠ¤", c:9, t:"old"},
    {n:"ì˜¤ë°”ëŒœ", c:1, t:"old"}, {n:"ìš”ë‚˜", c:4, t:"old"}, {n:"ë¯¸ê°€", c:7, t:"old"}, {n:"ë‚˜í›”", c:3, t:"old"}, {n:"í•˜ë°•êµ­", c:3, t:"old"},
    {n:"ìŠ¤ë°”ëƒ", c:3, t:"old"}, {n:"í•™ê°œ", c:2, t:"old"}, {n:"ìŠ¤ê°€ë´", c:14, t:"old"}, {n:"ë§ë¼ê¸°", c:4, t:"old"},
    {n:"ë§ˆíƒœë³µìŒ", c:28, t:"new"}, {n:"ë§ˆê°€ë³µìŒ", c:16, t:"new"}, {n:"ëˆ„ê°€ë³µìŒ", c:24, t:"new"}, {n:"ìš”í•œë³µìŒ", c:21, t:"new"}, {n:"ì‚¬ë„í–‰ì „", c:28, t:"new"},
    {n:"ë¡œë§ˆì„œ", c:16, t:"new"}, {n:"ê³ ë¦°ë„ì „ì„œ", c:16, t:"new"}, {n:"ê³ ë¦°ë„í›„ì„œ", c:13, t:"new"}, {n:"ê°ˆë¼ë””ì•„ì„œ", c:6, t:"new"}, {n:"ì—ë² ì†Œì„œ", c:6, t:"new"},
    {n:"ë¹Œë¦½ë³´ì„œ", c:4, t:"new"}, {n:"ê³¨ë¡œìƒˆì„œ", c:4, t:"new"}, {n:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ", c:5, t:"new"}, {n:"ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ", c:3, t:"new"},
    {n:"ë””ëª¨ë°ì „ì„œ", c:6, t:"new"}, {n:"ë””ëª¨ë°í›„ì„œ", c:4, t:"new"}, {n:"ë””ë„ì„œ", c:3, t:"new"}, {n:"ë¹Œë ˆëª¬ì„œ", c:1, t:"new"}, {n:"íˆë¸Œë¦¬ì„œ", c:13, t:"new"},
    {n:"ì•¼ê³ ë³´ì„œ", c:5, t:"new"}, {n:"ë² ë“œë¡œì „ì„œ", c:5, t:"new"}, {n:"ë² ë“œë¡œí›„ì„œ", c:3, t:"new"}, {n:"ìš”í•œ1ì„œ", c:5, t:"new"}, {n:"ìš”í•œ2ì„œ", c:1, t:"new"},
    {n:"ìš”í•œ3ì„œ", c:1, t:"new"}, {n:"ìœ ë‹¤ì„œ", c:1, t:"new"}, {n:"ìš”í•œê³„ì‹œë¡", c:22, t:"new"}
  ];

  let progress = JSON.parse(localStorage.getItem('bible_v3')) || {};
  let currentBook = "";

  function getLocalDate() {
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, '0');
    const d = String(now.getDate()).padStart(2, '0');
    return `${y}-${m}-${d}`;
  }

  function init() {
    const oGrid = document.getElementById('oldGrid');
    const nGrid = document.getElementById('newGrid');
    bible.forEach(b => {
      const div = document.createElement('div');
      div.className = 'book-item';
      div.innerText = b.n;
      div.onclick = () => openModal(b.n);
      if(b.t === 'old') oGrid.appendChild(div); else nGrid.appendChild(div);
    });
    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ ì„¸íŒ…
    document.getElementById('startDate').value = getLocalDate();
    document.getElementById('endDate').value = getLocalDate();
    updateUI();
  }

  function openModal(name) {
    currentBook = name;
    document.getElementById('modalTitle').innerText = name;
    const book = bible.find(b => b.n === name);
    const grid = document.getElementById('chapGrid');
    grid.innerHTML = '';
    
    for(let i=1; i<=book.c; i++) {
      const btn = document.createElement('button');
      btn.className = `chap-btn ${ (progress[name] && progress[name][i]) ? 'active' : '' }`;
      btn.innerText = i;
      btn.onclick = () => toggleChap(i, btn);
      grid.appendChild(btn);
    }
    document.getElementById('modal').style.display = 'flex';
  }

  function toggleChap(chap, btn) {
    const today = getLocalDate();
    if(!progress[currentBook]) progress[currentBook] = {};
    
    if(progress[currentBook][chap]) {
      delete progress[currentBook][chap];
      btn.classList.remove('active');
    } else {
      progress[currentBook][chap] = today;
      btn.classList.add('active');
    }
    updateUI();
  }

  function updateUI() {
    let count = 0;
    Object.values(progress).forEach(book => count += Object.keys(book).length);
    const percent = ((count / 1189) * 100).toFixed(1);
    document.getElementById('progressFill').style.width = percent + '%';
    document.getElementById('progressStat').innerText = `${count.toLocaleString()} / 1,189 ì¥ (${percent}%)`;
  }

  function calcRangeStats() {
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    if(!start || !end) return alert('ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    
    let total = 0;
    Object.values(progress).forEach(chaps => {
      Object.values(chaps).forEach(date => {
        if(date >= start && date <= end) total++;
      });
    });
    document.getElementById('rangeResult').innerHTML = 
      `ì„ íƒ ê¸°ê°„ ë™ì•ˆ <strong>${total}</strong> ì¥ì„ ì½ìœ¼ì…¨ìŠµë‹ˆë‹¤. ğŸ‘`;
  }

  function saveData() {
    localStorage.setItem('bible_v3', JSON.stringify(progress));
    alert('í˜„ì¬ ì§„ë„ê°€ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  function resetAll() {
    if(confirm('ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë©ë‹ˆë‹¤. ì´ˆê¸°í™”í• ê¹Œìš”?')) {
      progress = {};
      localStorage.removeItem('bible_v3');
      location.reload();
    }
  }

  function filterList(type) {
    document.getElementById('oldSection').style.display = (type==='new' ? 'none' : 'block');
    document.getElementById('newSection').style.display = (type==='old' ? 'none' : 'block');
  }

  function closeModal() { document.getElementById('modal').style.display = 'none'; }

  function downloadHTML() {
    const content = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
    const blob = new Blob([content], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'bible_reading_progress.html';
    a.click();
  }

  init();
</script>
</body>
</html>